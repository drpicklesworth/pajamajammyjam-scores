<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Pajama Jammy Jam — Scoreboard</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background: #111;
        color: #fff;
        text-align: center;
        padding: 20px;
    }
    h1 { font-size: 2.5em; margin-bottom: 10px; }
    #leaderboard {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 20px;
        margin-top: 20px;
    }
    .card {
        background: #222;
        border-radius: 14px;
        padding: 20px;
        width: 260px;
        text-align: center;
        box-shadow: 0 0 10px rgba(255,255,255,0.2);
        transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 0 14px rgba(255,255,255,0.35);
    }
    img {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        object-fit: cover;
        margin-bottom: 15px;
    }
    .rank {
        font-size: 1.4em;
        font-weight: bold;
        margin-bottom: 5px;
    }
    .name {
        font-size: 1.2em;
        margin-bottom: 5px;
    }
    .score {
        font-size: 1.1em;
        color: #6cf;
    }
    #status {
        margin-top: 15px;
        opacity: 0.7;
        font-size: 0.9em;
    }
</style>
</head>
<body>

<h1>Pajama Jammy Jam — Scoreboard</h1>
<div id="leaderboard"></div>
<div id="status">Loading scores…</div>

<script>
// Fallback avatar image for empty or broken photos
const fallbackImage = "https://upload.wikimedia.org/wikipedia/commons/thumb/5/59/User-avatar.svg/240px-User-avatar.svg.png";

async function loadScores() {
    try {
        // Load scores.csv from the same repo folder
        const res = await fetch("scores.csv?cache=" + Date.now());
        if (!res.ok) throw new Error("Fetch failed");

        const text = await res.text();
        document.getElementById("status").innerText = "Scores updated";

        // Parse CSV (skip first header row)
        const rows = text.trim().split("\n").slice(1);
        let data = rows.map(row => {
            const parts = row.split(",");
            return {
                name: parts[0],
                score: parseInt(parts[1]),
                photo: parts[2] || fallbackImage
            };
        });

        // Sort by score, descending
        data.sort((a, b) => b.score - a.score);

        render(data);

    } catch (error) {
        document.getElementById("status").innerText =
            "Could not load remote CSV — using fallback demo data.";

        const fallback = [
            {name:"Matt", score:11, photo:"https://www.myclickmagazine.com/wp-content/uploads/2020/09/leslie-crane-creative-headshots-5.jpg"},
            {name:"David", score:16, photo:fallbackImage},
            {name:"Jessica", score:14, photo:"https://www.myclickmagazine.com/wp-content/uploads/2020/09/leslie-crane-creative-headshots-1-1320x943.jpg"}
        ].sort((a,b)=>b.score - a.score);

        render(fallback);
    }
}

function render(data) {
    const container = document.getElementById("leaderboard");
    container.innerHTML = "";

    data.forEach((p, i) => {
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
            <div class="rank">#${i + 1}</div>
            <img src="${p.photo || fallbackImage}" onerror="this.src=fallbackImage">
            <div class="name">${p.name}</div>
            <div class="score">${p.score} points</div>
        `;
        container.appendChild(card);
    });
}

// Initial load
loadScores();

// Refresh CSV every 15 seconds
setInterval(loadScores, 15000);
</script>

</body>
</html>
